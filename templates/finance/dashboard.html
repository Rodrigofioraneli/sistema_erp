{% extends 'base.html' %}

{% block content %}
<style>
    .kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
    .kpi-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; }
    .kpi-value { font-size: 1.8rem; font-weight: bold; margin-top: 10px; }
    .text-green { color: #27ae60; }
    .text-red { color: #c0392b; }
    .text-blue { color: #2980b9; }
    
    .section-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .btn-add { background: #2c3e50; color: white; text-decoration: none; padding: 8px 15px; border-radius: 6px; font-size: 0.9rem; }
    
    .table-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 30px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
    .bg-pending { background: #f1c40f; color: #fff; }
    .bg-overdue { background: #e74c3c; color: #fff; }
</style>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h1 style="margin: 0; color: #2c3e50;">üìâ Financeiro</h1>
    <div>
        <a href="{% url 'financial_reports' %}" class="btn-add" style="background: #8e44ad; margin-right: 10px;">üìä Relat√≥rios Gerenciais</a>
        <a href="{% url 'transaction_create' %}" class="btn-add">‚ûï Novo Lan√ßamento</a>
    </div>
</div>

<!-- KPIs -->
<div class="kpi-grid">
    <div class="kpi-card">
        <div style="color: #7f8c8d;">Receitas (Pago)</div>
        <div class="kpi-value text-green">R$ {{ total_income|floatformat:2 }}</div>
    </div>
    <div class="kpi-card">
        <div style="color: #7f8c8d;">Despesas (Pago)</div>
        <div class="kpi-value text-red">R$ {{ total_expense|floatformat:2 }}</div>
    </div>
    <div class="kpi-card">
        <div style="color: #7f8c8d;">Saldo Atual</div>
        <div class="kpi-value text-blue">R$ {{ balance|floatformat:2 }}</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <!-- Contas a Pagar -->
    <div class="table-card">
        <h3 style="margin-top: 0; color: #c0392b;">üîª Contas a Pagar (Pendentes)</h3>
        <table>
            <thead><tr><th>Vencimento</th><th>Descri√ß√£o</th><th>Valor</th><th>A√ß√£o</th></tr></thead>
            <tbody>
                {% for item in payables %}
                <tr>
                    <td>{{ item.due_date|date:"d/m/Y" }}</td>
                    <td>{{ item.description }}</td>
                    <td style="font-weight: bold;">R$ {{ item.value }}</td>
                    <td><a href="{% url 'transaction_edit' item.pk %}">‚úèÔ∏è</a></td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align: center; color: #999;">Nenhuma conta pendente.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Contas a Receber -->
    <div class="table-card">
        <h3 style="margin-top: 0; color: #27ae60;">üî∫ Contas a Receber (Pendentes)</h3>
        <table>
            <thead><tr><th>Vencimento</th><th>Descri√ß√£o</th><th>Valor</th><th>A√ß√£o</th></tr></thead>
            <tbody>
                {% for item in receivables %}
                <tr>
                    <td>{{ item.due_date|date:"d/m/Y" }}</td>
                    <td>{{ item.description }}</td>
                    <td style="font-weight: bold;">R$ {{ item.value }}</td>
                    <td><a href="{% url 'transaction_edit' item.pk %}">‚úèÔ∏è</a></td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align: center; color: #999;">Nenhum recebimento pendente.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Inadimpl√™ncia -->
{% if overdue %}
<div class="table-card" style="border: 2px solid #e74c3c;">
    <h3 style="margin-top: 0; color: #c0392b;">‚ö†Ô∏è Inadimpl√™ncia (Atrasados)</h3>
    <table>
        <thead><tr><th>Vencimento</th><th>Descri√ß√£o</th><th>Valor</th><th>Status</th></tr></thead>
        <tbody>
            {% for item in overdue %}
            <tr>
                <td style="color: #c0392b; font-weight: bold;">{{ item.due_date|date:"d/m/Y" }}</td>
                <td>{{ item.description }}</td>
                <td>R$ {{ item.value }}</td>
                <td><span class="status-badge bg-overdue">Atrasado</span></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}